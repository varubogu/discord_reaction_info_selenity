# 開発に関して

## 開発環境

言語: Rust
フレームワーク: Selenity

## 技術仕様

### 使用ライブラリ

- tokio: 非同期ランタイム
- Selenity: Discord API クライアント
- anyhow: エラーハンドリング
- tracing: ログ出力
- dotenv: 環境変数管理

### 必要なDiscord Bot権限

- メッセージ履歴の読み取り
- メッセージの送信
- リアクションの読み取り
- スラッシュコマンドの使用

### 環境変数

- `DISCORD_TOKEN`: BotのDiscordトークン

## 制限事項

- Discord APIのレート制限に従う
- 大量のリアクションがある場合の処理時間
- メッセージの保持期間による制約
- 同時実行数の制限

## パフォーマンス考慮

- 1メッセージあたりの最大リアクション数: 100個
- 1リアクションあたりの最大ユーザー数: 1000人
- 1メッセージあたりの最大ユーザー数: 10000人
- コマンド実行タイムアウト: 15秒
- 同時実行制限: ユーザーあたり1件

## 注意点

- プライベートチャンネルでの動作制限
- 削除されたユーザーの扱い
- 大きなサーバーでのパフォーマンス考慮

## コーディング規約

- 1行あたりの文字数: 半角80文字以内
- 1関数あたりの行数: 50行以下
- docstringがつけられるものは必ずつける。（構造体、トレイト、関数など）
- 1ファイルあたりの行数: 200行以下（テストモジュール部分を除く）
- ネスト: 関数の中に入ってから3段階まで
- DRY原則、SOLID原則を遵守する
- 単体テストは同ファイルのtestモジュールで行う
- 結合テストは`tests/integration/**.rs`で行う
- 総合テストは`tests/system/**.rs`で行う
- その他、Rustの一般的なコーディング規約に遵守する

## プロジェクト構成

```
(root)
├── .env          # 環境変数（ローカル用）
├── Cargo.toml    # cargoクレート定義
├── Cargo.lock    # cargoインストール済みクレート定義
├── docs/         # ドキュメント
├── src/          # ソースコード
│   ├── main.rs   # エントリポイント～イベントループまでのロジック
│   ├── init.rs   # bot起動までの初期化処理を定義
│   ├── events/                 # イベント全般 ※受け口のみを定義し、実際のロジックはsrc/services/配下に配置する
│   │   ├── mod.rs              # モジュール宣言
│   │   ├── on_message.rs       # メッセージが送信された時のリスナー
│   │   ├── on_reaction_add.rs  # メッセージにリアクションされた時のリスナー
│   │   ├── xxxxx.rs            # イベントに応じたリスナー、イベント名をそのままファイル名にする
│   │   ├── interactions/       # インタラクション全般
│   │   │   ├── command_interactions/     # コマンド系インタラクション
│   │   │   │   ├── mod.rs                # モジュール宣言
│   │   │   │   ├── slash/                # スラッシュコマンドの定義
│   │   │   │   │   ├── mod.rs            # モジュール宣言
│   │   │   │   │   ├── rmem_slash.rs     # リアクションしたユーザー情報を収集して表示するスラッシュコマンド
│   │   │   │   │   ├── xxxx_slash.rs     # スラッシュコマンドは「_slash.rs」で終わること
│   │   │   │   ├── contextmenu/                          # コンテキストメニュー系インタラクション
│   │   │   │   │   ├── mod.rs                            # モジュール宣言
│   │   │   │   │   ├── reaction_users_context_menu.rs    # リアクションしたユーザー情報を収集して表示するコンテキストメニュー
│   │   │   │   │   ├── xxxx_context_menu.rs              # コンテキストメニューは「_context_menu.rs」で終わること
│   │   │   ├── components/             # コンポーネントのインタラクション
│   │   │   │   ├── xxxx_component.rs   # コンポーネントは「_component.rs」で終わること
│   │   │   ├── modal/                  # モーダルをユーザーが送信した時のインタラクション
│   │   │   │   ├── xxxx_modal.rs       # モーダルは「_modal.rs」で終わること
│   ├── services/               # ビジネスロジックを配置、規模が大きい場合はフォルダ分けも検討する
│   │   ├── mod.rs              # モジュール宣言
│   │   ├── reaction_users.rs   # リアクションしたユーザー情報を収集し、結果を返す
│   │   ├── xxx.rs              # ビジネスロジック
│   ├── utils/        # 汎用的な処理をまとめるフォルダ
│   │   ├── mod.rs    # モジュール宣言
│   │   ├── xxx.rs    # 汎用的な処理
├── tests/            # テストコード
│   ├── integration/  # 結合テスト
│   ├── system/       # 総合テスト
```
